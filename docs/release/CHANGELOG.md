# 更新日志 (Changelog)

- 适用版本: `>=1.0.0`
- 文档状态: `active`
- 最后更新: `2026-02-27`

本文档记录 Ghost-Dir 项目的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [1.0.3] - 2026-02-27

### 新增 (Added)

- USN Journal 全盘深度链接扫描（无深度限制，单盘 2-5 秒）
- 双模式探测引擎：USN Journal 优先 + 目录遍历降级
- 系统链接智能过滤（`HIDDEN+SYSTEM` 属性 + 路径特征）
- 非模板链接分类选择器

### 优化 (Changed)

- 路径文本 `ElideMiddle` 省略 + tooltip 显示完整路径
- 仅扫描本地固定磁盘（`DRIVE_FIXED`），排除网络盷、U 盘
- 分类下拉面板禁用水平滚动条

### 修复 (Fixed)

- 修复 exe 入口缺少管理员权限请求，导致 USN Journal 静默降级
- 修复 `USN_RECORD_V2` 结构体解析偶移错位
- 修复 ctypes 64 位句柄比较逻辑错误
- 修复 PyInstaller 延迟 import 丢失 `usn_journal` 模块

---

## [1.0.2] - 2026-02-26

### 修复 (Fixed)

- 修复“新增链接”模板名称搜索失效
- 修复“新增链接”分类筛选失效
- 修复选择分类时崩溃（`CategoryNode.full_path_name` 不存在）

---

## [1.0.1] - 2026-02-17

### 修复 (Fixed)

- 修复链接迁移时源路径被进程锁定（如 `razer_elevation_service.exe`）导致的无限循环 Bug
- 修复链接冲突处理：当目标软件路径已有数据时，提供覆盖/迁移/取消三种选项
- 修复启动画面（Splash Screen）未跟随系统主题适配的问题，新增 Mica 效果支持

### 优化 (Changed)

- 修复 PyInstaller 打包后模块导入错误，完善 `.spec` 隐藏导入配置
- 将 `config` 目录直接内嵌到打包产物中，移除运行时自动初始化逻辑，实现开箱即用

---

## [1.0.0] - 2026-02-04

### 🎉 首个正式版本发布

Ghost-Dir 1.0.0 是第一个生产就绪版本，提供完整的 Windows 目录迁移与连接管理解决方案。

### ✨ 新增功能

#### 核心功能
- **智能向导系统**：自动扫描本机可管理软件，一键批量导入
- **模版库系统**：内置官方模版库，支持搜索、筛选和分类浏览
- **自定义模版**：保存常用配置为模版，快速复用
- **扫描忽略列表**：永久忽略不需要的软件，避免重复扫描
- **连接管理**：建立、断开、修复连接，支持批量操作
- **分类管理**：树形分类结构，支持创建、编辑、删除分类

#### 安全机制
- **事务管理器**：原子操作，失败自动回滚
- **崩溃恢复**：通过锁文件机制，启动时自动恢复未完成操作
- **进程卫士**：操作前检测文件占用，提供进程结束选项
- **路径验证**：黑名单机制，防止误操作系统关键目录
- **无缓存移动**：直接移动文件，不占用双倍磁盘空间

#### 用户界面
- **5 页面导航**：智能向导、我的连接、模版库、帮助、设置
- **Fluent Design**：遵循微软 Fluent 设计语言
- **窗口特效**：
  - Windows 11：Mica 云母半透明效果
  - Windows 10：Acrylic 亚克力毛玻璃效果
- **响应式布局**：左树右表/卡片，自适应窗口大小
- **批量操作工具栏**：选中多项时自动显示
- **国际化支持**：完整中文界面

#### 数据管理
- **持久化存储**：JSON 格式存储用户数据和配置
- **数据导入导出**：支持连接和模版的导入导出
- **配置管理**：默认仓库路径、视图偏好等设置
- **日志系统**：详细的操作日志，便于问题排查

### 🔧 技术架构

#### 分层设计（当前架构）
- **GUI 层**（`src/gui`）：视图、对话框、组件
- **Service 层**（`src/services`）：业务逻辑封装与流程编排
- **DAO/Drivers 层**（`src/dao`、`src/drivers`）：数据持久化与系统能力封装
- **Models/Common 层**（`src/models`、`src/common`）：数据模型与全局基础能力

#### 核心组件
- `TransactionManager`：事务管理器，确保操作原子性
- `ProcessGuard`：进程卫士，检测文件占用
- `SmartScanner`：智能扫描器，发现可管理软件
- `TemplateService`：模版服务，官方和自定义模版业务逻辑
- `LinkService`：连接服务，业务逻辑封装
- `ConfigService`：配置服务，配置读写与初始化编排

### 🐛 修复问题

#### UI 修复
- 修复国际化键映射错误导致文本缺失
- 修复主题切换时分类树未更新的问题
- 修复表格对齐问题，特别是复选框对齐
- 修复字体大小警告（`QFont::setPointSize <= 0`）
- 修复批量操作工具栏未自动隐藏的问题
- 修复默认视图设置未正确应用的问题

#### 功能修复
- 修复连接建立/断开后 UI 冻结问题
- 修复导入连接后表格未显示的问题
- 修复异步操作阻塞 UI 的问题
- 修复扫描器缺少 `os` 模块导入的错误
- 修复帮助图标不统一的问题

#### 架构优化
- 重构分类树组件，消除代码重复
- 将业务逻辑从 UI 层迁移到 Service 层
- 统一异步操作处理模式
- 优化布局高度，确保内容完全展开

### 📚 文档完善

- **README.md**：完整的项目介绍和使用指南
- **用户文档**：入门指南、使用指南、故障排除
- **开发文档**：架构设计、开发指南、测试文档
- **参考文档**：UI 设计规范、API 参考、技术笔记
- **CHANGELOG.md**：版本更新日志
- **notes/vX.Y.Z.md**：发布说明

### 🔄 重构优化

- 统一导入路径规范
- 组件职责分离，提高可维护性
- 信号通信机制，解耦组件依赖
- View/Widgets 分层设计
- 异步操作抽象为通用组件

### ⚠️ 已知限制

1. **仅支持 Windows**：连接点（Junction）是 Windows 特有功能
2. **需要 NTFS**：目标驱动器必须是 NTFS 文件系统
3. **需要管理员权限**：创建连接点需要以管理员身份运行
4. **不支持跨物理驱动器**：连接点只能在同一物理驱动器内工作

### 📦 依赖版本

- Python 3.8+
- PySide6 6.6+
- PySide6-Fluent-Widgets[full] 1.5+
- psutil 5.9+
- pywin32 306+
- Pillow 10.0+

---

## [0.1.0] - 2026-01-21 (内部测试版)

### 初始功能
- 基础连接管理
- 简单的 UI 界面
- 基本的事务管理

---

## 版本说明

### 版本号格式：主版本号.次版本号.修订号

- **主版本号**：不兼容的 API 修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 变更类型

- **新增 (Added)**：新功能
- **变更 (Changed)**：现有功能的变更
- **弃用 (Deprecated)**：即将移除的功能
- **移除 (Removed)**：已移除的功能
- **修复 (Fixed)**：Bug 修复
- **安全 (Security)**：安全相关的修复

---

[1.0.3]: https://github.com/gzers/ghost-dir/compare/v1.0.2...v1.0.3
[1.0.2]: https://github.com/gzers/ghost-dir/compare/v1.0.1...v1.0.2
[1.0.1]: https://github.com/gzers/ghost-dir/compare/v1.0.0...v1.0.1
[1.0.0]: https://github.com/gzers/ghost-dir/releases/tag/v1.0.0
[0.1.0]: https://github.com/gzers/ghost-dir/releases/tag/v0.1.0
