# Ghost-Dir v7.4 å‡çº§å®ç°è®¡åˆ’

## ğŸ“‹ PRD v7.4 vs å½“å‰ç‰ˆæœ¬å¯¹æ¯”

### ğŸ†• æ–°å¢åŠŸèƒ½

| åŠŸèƒ½ | å½“å‰çŠ¶æ€ | v7.4 è¦æ±‚ | ä¼˜å…ˆçº§ |
|------|---------|-----------|--------|
| **å¯¼èˆªç»“æ„** | ä»… 2 ä¸ªé¡µé¢ | 5 ä¸ªç‹¬ç«‹è§†å›¾ | P0 |
| **æ™ºèƒ½å‘ç°é¡µé¢** | âŒ æ—  | ç‹¬ç«‹å¤§å±å±•ç¤º | P0 |
| **æ¨¡ç‰ˆåº“è§†å›¾** | âŒ æ—  | åªè¯»å±•ç¤ºæ‰€æœ‰æ¨¡ç‰ˆ | P0 |
| **è‡ªå®šä¹‰æ¨¡ç‰ˆä¿å­˜** | âŒ æ—  | ç”¨æˆ·å¯ä¿å­˜æ¨¡ç‰ˆ | P0 |
| **æ‰«æå¿½ç•¥åå•** | âŒ æ—  | æ°¸ä¹…å¿½ç•¥åŠŸèƒ½ | P1 |
| **é»˜è®¤ä»“åº“è·¯å¾„** | âŒ æ—  | å…¨å±€é…ç½® | P0 |
| **å¸®åŠ©/å…³äºé¡µé¢** | ä»…è®¾ç½®ä¸­æœ‰ | ç‹¬ç«‹è§†å›¾ | P1 |

### ğŸ”„ éœ€è¦ä¿®æ”¹çš„åŠŸèƒ½

| åŠŸèƒ½ | å½“å‰å®ç° | v7.4 è¦æ±‚ | å˜æ›´å†…å®¹ |
|------|---------|-----------|---------|
| **ä¸»çª—å£å¯¼èˆª** | ä¾§è¾¹æ  2 é¡¹ | ä¾§è¾¹æ  5 é¡¹ï¼ˆé¡¶éƒ¨ 3 + åº•éƒ¨ 2ï¼‰ | é‡æ„å¯¼èˆª |
| **æ–°å¢è¿æ¥å¯¹è¯æ¡†** | åŒæ ‡ç­¾é¡µ | å¢åŠ "ä¿å­˜ä¸ºæ¨¡ç‰ˆ"åŠŸèƒ½ | å¢å¼ºåŠŸèƒ½ |
| **ç”¨æˆ·æ•°æ®æ¨¡å‹** | åŸºç¡€å­—æ®µ | å¢åŠ  `custom_templates`, `ignored_ids`, `default_target_root` | æ‰©å±•æ•°æ® |
| **æ¨¡ç‰ˆç®¡ç†å™¨** | ä»…è¯»å–å®˜æ–¹æ¨¡ç‰ˆ | åˆå¹¶å®˜æ–¹ + è‡ªå®šä¹‰æ¨¡ç‰ˆ | å¢å¼ºé€»è¾‘ |

---

## ğŸ¯ å®æ–½è®¡åˆ’

### Phase 1: æ•°æ®å±‚å‡çº§ (P0)

#### 1.1 æ‰©å±•ç”¨æˆ·æ•°æ®æ¨¡å‹
**æ–‡ä»¶**: `src/data/model.py`, `src/data/user_manager.py`

**æ–°å¢å­—æ®µ**:
```python
@dataclass
class UserData:
    items: List[UserLink]              # å·²æœ‰
    categories: List[Category]         # å·²æœ‰
    custom_templates: List[Template]   # ğŸ†• ç”¨æˆ·è‡ªå®šä¹‰æ¨¡ç‰ˆ
    ignored_ids: List[str]             # ğŸ†• æ‰«æå¿½ç•¥åå•
    default_target_root: str           # ğŸ†• é»˜è®¤ä»“åº“è·¯å¾„
```

**æ–°å¢æ–¹æ³•**:
- `add_custom_template(template: Template)`
- `get_all_templates()` - åˆå¹¶å®˜æ–¹ + è‡ªå®šä¹‰
- `add_to_ignore_list(template_id: str)`
- `is_ignored(template_id: str)`
- `set_default_target_root(path: str)`

#### 1.2 å¢å¼ºæ¨¡ç‰ˆç®¡ç†å™¨
**æ–‡ä»¶**: `src/data/template_manager.py`

**å˜æ›´**:
```python
class TemplateManager:
    def get_all_templates(self) -> List[Template]:
        """åˆå¹¶å®˜æ–¹æ¨¡ç‰ˆ + ç”¨æˆ·è‡ªå®šä¹‰æ¨¡ç‰ˆ"""
        official = self._load_official_templates()
        custom = self.user_manager.get_custom_templates()
        return official + custom
```

---

### Phase 2: æ–°å¢è§†å›¾ (P0)

#### 2.1 æ™ºèƒ½å‘ç°è§†å›¾
**æ–°å»º**: `src/gui/views/discovery/`
```
discovery/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ scan_view.py           # ä¸»è§†å›¾
â”œâ”€â”€ scan_result_card.py    # æ‰«æç»“æœå¡ç‰‡
â””â”€â”€ scan_progress.py       # æ‰«æè¿›åº¦ç»„ä»¶
```

**åŠŸèƒ½**:
- å¤§å±å±•ç¤ºæ‰«æå…¥å£
- åå°æ‰«æ + è¿›åº¦æ¡
- ç»“æœåˆ—è¡¨ï¼ˆå¸¦å¿½ç•¥åŠŸèƒ½ï¼‰
- ä¸€é”®å¯¼å…¥ â†’ è·³è½¬åˆ°ä¸»æ§åˆ¶å°

#### 2.2 æ¨¡ç‰ˆåº“è§†å›¾
**æ–°å»º**: `src/gui/views/library/`
```
library/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ library_view.py        # ä¸»è§†å›¾
â””â”€â”€ template_card.py       # æ¨¡ç‰ˆå¡ç‰‡ç»„ä»¶
```

**åŠŸèƒ½**:
- åªè¯»å±•ç¤ºæ‰€æœ‰æ¨¡ç‰ˆï¼ˆå®˜æ–¹ + è‡ªå®šä¹‰ï¼‰
- åˆ†ç±»ç­›é€‰
- æœç´¢åŠŸèƒ½
- æ ‡è®°"å®˜æ–¹"/"è‡ªå®šä¹‰"

#### 2.3 å¸®åŠ©/å…³äºè§†å›¾
**æ–°å»º**: `src/gui/views/help/`
```
help/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ about_view.py          # ä¸»è§†å›¾
â””â”€â”€ tutorial_card.py       # æ•™ç¨‹å¡ç‰‡
```

**åŠŸèƒ½**:
- ç‰ˆæœ¬ä¿¡æ¯ï¼ˆä» settings ç§»è¿‡æ¥ï¼‰
- ä½¿ç”¨æ•™ç¨‹
- å¸¸è§é—®é¢˜

---

### Phase 3: å¯¼èˆªç»“æ„é‡æ„ (P0)

#### 3.1 ä¸»çª—å£å¯¼èˆª
**æ–‡ä»¶**: `src/gui/windows/main_window.py`

**å˜æ›´**:
```python
def _init_navigation(self):
    # é¡¶éƒ¨ä¸šåŠ¡åŒº
    self.addSubInterface(
        self.console_view, 
        FluentIcon.HOME, 
        "æˆ‘çš„è¿æ¥",
        NavigationItemPosition.TOP
    )
    
    self.addSubInterface(
        self.scan_view,
        FluentIcon.SEARCH,
        "æ™ºèƒ½å‘ç°",
        NavigationItemPosition.TOP
    )
    
    self.addSubInterface(
        self.library_view,
        FluentIcon.BOOK_SHELF,
        "æ¨¡ç‰ˆåº“",
        NavigationItemPosition.TOP
    )
    
    # åº•éƒ¨åŠŸèƒ½åŒº
    self.addSubInterface(
        self.about_view,
        FluentIcon.INFO,
        "å¸®åŠ©",
        NavigationItemPosition.BOTTOM
    )
    
    self.addSubInterface(
        self.setting_view,
        FluentIcon.SETTING,
        "è®¾ç½®",
        NavigationItemPosition.BOTTOM
    )
```

---

### Phase 4: åŠŸèƒ½å¢å¼º (P0)

#### 4.1 æ–°å¢è¿æ¥å¯¹è¯æ¡†å¢å¼º
**æ–‡ä»¶**: `src/gui/dialogs/add_link_dialog.py`

**æ–°å¢åŠŸèƒ½**:
- å¤é€‰æ¡†ï¼š`[ ] ä¿å­˜ä¸ºè‡ªå®šä¹‰æ¨¡ç‰ˆ`
- å‹¾é€‰åï¼Œå°†å½“å‰é…ç½®ä¿å­˜åˆ° `custom_templates`

```python
def validate(self):
    # ... ç°æœ‰é€»è¾‘ ...
    
    # ğŸ†• ä¿å­˜ä¸ºæ¨¡ç‰ˆ
    if self.save_as_template_checkbox.isChecked():
        template = Template(
            id=str(uuid.uuid4()),
            name=name,
            default_src=source,
            category=category,
            icon=None
        )
        self.user_manager.add_custom_template(template)
```

#### 4.2 æ‰«æç»“æœå³é”®èœå•
**æ–‡ä»¶**: `src/gui/views/discovery/scan_view.py`

**æ–°å¢**:
- å³é”®èœå•ï¼š`[ ğŸš« æ°¸ä¹…å¿½ç•¥ ]`
- ç‚¹å‡»åæ·»åŠ åˆ° `ignored_ids`

#### 4.3 è®¾ç½®é¡µé¢å¢å¼º
**æ–‡ä»¶**: `src/gui/views/settings/setting_view.py`

**æ–°å¢è®¾ç½®é¡¹**:
- é»˜è®¤ä»“åº“è·¯å¾„ï¼š`D:\Ghost_Library`
- æ—¥å¿—æ–‡ä»¶å¤¹ï¼š`[ ğŸ“‚ æ‰“å¼€æ—¥å¿—æ–‡ä»¶å¤¹ ]` æŒ‰é’®

---

### Phase 5: æ‰«æé€»è¾‘ä¼˜åŒ– (P1)

#### 5.1 æ‰«æè¿‡æ»¤
**æ–‡ä»¶**: `src/core/scanner.py`

**å¢å¼º**:
```python
def scan(self) -> List[Template]:
    discovered = []
    
    for template in self.template_manager.get_all_templates():
        # ğŸ†• è·³è¿‡å·²å¿½ç•¥
        if self.user_manager.is_ignored(template.id):
            continue
        
        # ğŸ†• è·³è¿‡å·²æ·»åŠ 
        if self.user_manager.has_link_for_template(template.id):
            continue
        
        # æ£€æŸ¥è·¯å¾„å­˜åœ¨
        if self._check_path_exists(template):
            discovered.append(template)
    
    return discovered
```

---

## ğŸ“ æ–°å¢æ–‡ä»¶æ¸…å•

### è§†å›¾å±‚
- `src/gui/views/discovery/__init__.py`
- `src/gui/views/discovery/scan_view.py`
- `src/gui/views/discovery/scan_result_card.py`
- `src/gui/views/discovery/scan_progress.py`
- `src/gui/views/library/__init__.py`
- `src/gui/views/library/library_view.py`
- `src/gui/views/library/template_card.py`
- `src/gui/views/help/__init__.py`
- `src/gui/views/help/about_view.py`
- `src/gui/views/help/tutorial_card.py`

### å·¥å…·å±‚
- `src/common/logger.py` - æ—¥å¿—ç®¡ç†å™¨

---

## ğŸ”„ éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

### æ•°æ®å±‚
- âœï¸ `src/data/model.py` - æ‰©å±• UserData
- âœï¸ `src/data/user_manager.py` - æ–°å¢æ–¹æ³•
- âœï¸ `src/data/template_manager.py` - åˆå¹¶é€»è¾‘

### æ ¸å¿ƒå±‚
- âœï¸ `src/core/scanner.py` - è¿‡æ»¤é€»è¾‘

### GUI å±‚
- âœï¸ `src/gui/windows/main_window.py` - å¯¼èˆªé‡æ„
- âœï¸ `src/gui/dialogs/add_link_dialog.py` - ä¿å­˜æ¨¡ç‰ˆ
- âœï¸ `src/gui/views/settings/setting_view.py` - æ–°å¢è®¾ç½®

---

## ğŸ“Š å·¥ä½œé‡è¯„ä¼°

| é˜¶æ®µ | å·¥ä½œé‡ | ä¼˜å…ˆçº§ | é¢„è®¡æ—¶é—´ |
|------|--------|--------|---------|
| Phase 1: æ•°æ®å±‚å‡çº§ | ä¸­ | P0 | 2-3 å°æ—¶ |
| Phase 2: æ–°å¢è§†å›¾ | å¤§ | P0 | 4-5 å°æ—¶ |
| Phase 3: å¯¼èˆªé‡æ„ | å° | P0 | 1 å°æ—¶ |
| Phase 4: åŠŸèƒ½å¢å¼º | ä¸­ | P0 | 2-3 å°æ—¶ |
| Phase 5: æ‰«æä¼˜åŒ– | å° | P1 | 1 å°æ—¶ |
| **æ€»è®¡** | - | - | **10-13 å°æ—¶** |

---

## âš ï¸ å…¼å®¹æ€§æ³¨æ„äº‹é¡¹

### æ•°æ®è¿ç§»
ç°æœ‰ `user_data.json` éœ€è¦å…¼å®¹å‡çº§ï¼š
```python
def migrate_user_data(old_data: dict) -> dict:
    """v1.0 â†’ v7.4 æ•°æ®è¿ç§»"""
    if 'custom_templates' not in old_data:
        old_data['custom_templates'] = []
    if 'ignored_ids' not in old_data:
        old_data['ignored_ids'] = []
    if 'default_target_root' not in old_data:
        old_data['default_target_root'] = "D:\\Ghost_Library"
    return old_data
```

### å‘åå…¼å®¹
- ä¿æŒç°æœ‰ API ä¸å˜
- æ–°å¢åŠŸèƒ½é€šè¿‡å¯é€‰å‚æ•°å®ç°
- æ—§ç‰ˆæ•°æ®è‡ªåŠ¨è¿ç§»

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] 5 ä¸ªå¯¼èˆªé¡µé¢æ­£å¸¸åˆ‡æ¢
- [ ] æ™ºèƒ½å‘ç°å¯æ‰«æå¹¶å¯¼å…¥
- [ ] æ¨¡ç‰ˆåº“æ­£ç¡®æ˜¾ç¤ºå®˜æ–¹ + è‡ªå®šä¹‰
- [ ] æ–°å¢è¿æ¥å¯ä¿å­˜ä¸ºæ¨¡ç‰ˆ
- [ ] æ‰«æç»“æœå¯æ°¸ä¹…å¿½ç•¥
- [ ] é»˜è®¤ä»“åº“è·¯å¾„å¯é…ç½®

### æ€§èƒ½éªŒæ”¶
- [ ] æ‰«æé€Ÿåº¦ < 30 ç§’ï¼ˆC ç›˜ï¼‰
- [ ] é¡µé¢åˆ‡æ¢æµç•…ï¼ˆ< 100msï¼‰
- [ ] æ¨¡ç‰ˆåº“åŠ è½½ < 1 ç§’

### UI éªŒæ”¶
- [ ] å¯¼èˆªæ åŠé€æ˜æ•ˆæœæ­£å¸¸
- [ ] æ‰€æœ‰é¡µé¢ç¬¦åˆ Fluent Design
- [ ] å“åº”å¼å¸ƒå±€é€‚é…ä¸åŒçª—å£å¤§å°

---

## ğŸš€ å®æ–½é¡ºåº

1. **Phase 1** - æ•°æ®å±‚å‡çº§ï¼ˆåŸºç¡€ï¼‰
2. **Phase 3** - å¯¼èˆªé‡æ„ï¼ˆæ¡†æ¶ï¼‰
3. **Phase 2** - æ–°å¢è§†å›¾ï¼ˆæ ¸å¿ƒï¼‰
4. **Phase 4** - åŠŸèƒ½å¢å¼ºï¼ˆå®Œå–„ï¼‰
5. **Phase 5** - æ‰«æä¼˜åŒ–ï¼ˆä¼˜åŒ–ï¼‰

å»ºè®®æŒ‰æ­¤é¡ºåºé€æ­¥å®æ–½ï¼Œæ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œæµ‹è¯•éªŒè¯ã€‚
